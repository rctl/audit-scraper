#!/bin/bash
if [ -z $1 ]; then
    echo "No seach string provided"
    echo "Usage:"
    echo "./vulnerabilitycounter.sh [package name]"
    exit 1
fi

RESULTS="$(pwd)/csv"
INPUT=$1
VULNERABILITIES="$(grep -r -i --include \*audit.csv "^.*,.*,*.,$INPUT," $RESULTS)"
printf "Number of repos with vulnerabilities: "
NUMBEROFV="$(echo -n "${VULNERABILITIES}" | sort -u -t: -k1,1 | wc -l)"
echo "${NUMBEROFV}"

printf "Number vulnerability types: "
if [ $NUMBEROFV != 0 ]; then
    echo -n "${VULNERABILITIES}" | sort -u -t, -k3,3 | wc -l
else
    echo "0"
fi